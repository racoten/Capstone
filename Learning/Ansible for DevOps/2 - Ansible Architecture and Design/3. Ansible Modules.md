
Modules are used to be executed on hosts

# Setup

The `setup` module is used to gather facts about hosts in JSON format:
```bash
ansible centos1 -m setup
```

![[Pasted image 20230809150336.png]]

# File

The `File` module is used to work with the file system to create files and symlinks:
```bash
ansible all -m file -a 'path=/tmp/test.txt state=touch'
```

![[Pasted image 20230809150517.png]]

The file was created on all machines since we specified to interact with all of them.

The output is in yellow indicating that it was a success and that changes were made.

![[Pasted image 20230809150603.png]]

We can also change the permissions of a file:
```bash
ansible all -m file -a 'path=/tmp/test.txt state=file mode=600'
```

![[Pasted image 20230809151215.png]]

# Idempotency

An operation is idempotent, if the result performing it once, is the same as if performing it repeatedly without change

We can test for idempotency with:
```bash
chmod 644 /tmp/test.txt
ansible all -m file -a 'path=/tmp/test.txt state=file mode=600'
```

![[Pasted image 20230809151558.png]]

We can see that the `test.txt` file in centos1 was already 600 but our local instance's `test.txt` was 644. When using the module, our local instance's file changed, but the other ones did not. Hence why in yellow and green.

# Copy

We can copy files from source to destination for each host:
```bash
touch /tmp/x
ansible all -m copy -a 'src=/tmp/x dest=/tmp/x'
```

We can also copy files from remote sources:
```bash
ansible all -m copy -a 'remote_src=yes src=/tmp/x dest=/tmp/y'
```

# Command

The command module is used to execute commands on host machines:
```bash
ansible all -m command -a 'id' -o
```

![[Pasted image 20230809160407.png]]

It does not pass pipes, redirections, command chains or pass in environment variables.

# Challenge

- Create a file using the `File` module
- Have it with 600 permissions
- Use the `Fetch` module to copy the remote file to our local system

