# 20. Modules and Crates

## Crates

In Rust nomenclature, a "crate" is anything that the Rust compiler spits out, regardless of whether it's an EXE or DLL.  Although if you wrote a program in Rust, you wouldn't necessarily refer to it as a Rust crate.  You would probably just call it an app or application.

The term crate is more often used to refer to libraries, which you'll understand as we go into modules and dependencies.

## Modules

Up until now, we've only written code inside main.rs.  In larger, more complex applications, you would not want 100% of your code to be in the same file.  It's common practice to break related functionality up into their own files, as this makes finding and maintaining a codebase much easier.

In a language like C#, these are broken down into namespace and classes.  In Rust, they're called modules.

To create a new source code file (in CLion at least), right-click on the `src` directory in the project tree, go to **New > Rust File**.  Give it a name - I'll call mine `calc.rs`, and hit **Enter**.

Now add whatever code is relevant to this module.

```rust
pub fn add(i1: i32, i2: i32) -> i32 {  
    i1 + i2  
}  
  
pub fn subtract(i1: i32, i2: i32) -> i32 {  
    i1 - i2  
}
```

You'll notice the addition of another keyword here, `pub`.  This is to declare that these functions are public and may be called from outside of this module.  To make main.rs aware of this new calc module, we must add a `mod` statement at the top.  Rust will infer the module name from the filename.  Since this is called `calc.rs`, the module name will be **calc**.

```rust
mod calc;  
  
fn main() {  
    let result = calc::add(10, 5);  
    println!("{}", result);  
}
```

We can shorten the use of `calc::add` by adding it as an addition `use` statement.

```rust
mod calc;  
use calc::add;  
  
fn main() {  
    let result = add(10, 5);  
    println!("{}", result);  
}
```

You can import multiple functions from the same module on a single line by wrapping a comma-separated list of names in curly braces:  `use calc::{add,subtract};` or simply import every function from a module using an asterix:  `use calc::*;`.

## Dependencies

The [Rust Package Registry](https://crates.io/) is a community-driven repository for Rust crates.  You can write and publish your own crates, or use existing crates as dependencies in your project.  There is a lot of useful functionality that is not included in the Rust standard library - which leaves you with two choices:  write it yourself, or find an existing crate.

One of the most downloaded crates is [rand](https://crates.io/crates/rand), which allows you to generate random numbers.  You can add it to your project in one of two ways.

The first is to use the `cargo` command line utility.

![](https://files.cdn.thinkific.com/file_uploads/584845/images/204/fa2/641/cargo-add.png)

The second is to manually modify `Cargo.toml`.

![](https://files.cdn.thinkific.com/file_uploads/584845/images/49a/323/507/toml.png)

The package is now available to be used in your code.

```rust
use rand::random;  
  
fn main() {  
    let rand = random::<u32>();  
    println!("Your random number is: {}", rand);  
}
```

![](https://files.cdn.thinkific.com/file_uploads/584845/images/329/64c/539/rand-output.png)

## Building

All the code we've executed thus far has been via `cargo run`.  This builds an unoptimised, debug version of the application which you can find in the `target\debug` directory.
```powershell
PS C:\Users\Daniel\CLionProjects\hello-world> ls .\target\debug\

    Directory: C:\Users\Daniel\CLionProjects\hello-world\target\debug


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        07/02/2023     15:53                .fingerprint
d-----        07/02/2023     15:53                build
d-----        07/02/2023     15:53                deps
d-----        07/02/2023     15:53                examples
d-----        07/02/2023     15:53                incremental
-a----        07/02/2023     15:53              0 .cargo-lock
-a----        07/02/2023     15:53            126 hello-world.d
-a----        07/02/2023     15:53         157696 hello-world.exe
-a----        07/02/2023     15:53        1380352 hello_world.pdb
```

To build a release version, run `cargo build --release`.
```powershell
PS C:\Users\Daniel\CLionProjects\hello-world> cargo build --release
   Compiling hello-world v0.1.0 (C:\Users\Daniel\CLionProjects\hello-world)
    Finished release [optimized] target(s) in 0.33s
```
  

This will output to the `target\release` directory.
```powershell
PS C:\Users\Daniel\CLionProjects\hello-world> .\target\release\hello-world.exe
Hello, world!
```